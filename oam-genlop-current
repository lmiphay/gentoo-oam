#!/bin/bash

source /etc/gentoo-oam.conf || oam_die "/etc/gentoo-oam.conf missing - exiting"
source /usr/share/gentoo-oam/gentoo-oam-functions.sh

oam_genlop_filter()
{
    read empty
    read currently merging num out of total
    read empty
    read start package
    read empty
    read current merge time runtime
    read eta estimatetime

    echo -e "$(oam_ts) $num/$total pkgs\n  $package \n  Gone: $runtime \n  Left: $estimatetime" | \
	sed -e 's/minutes/min/g;s/seconds./sec/g;s/hour/hr/g;s/ and / /g'
}

while /bin/true; do
       oam-uptime
       if [[ -n "$(pgrep sandbox)" ]] ; then
               genlop --nocolor --current | oam_genlop_filter
       fi
       sleep 60
done

exit 0
