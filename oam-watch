#!/bin/bash

source /usr/share/gentoo-oam/gentoo-oam-functions.sh
source /etc/gentoo-oam.conf || oam_die "/etc/gentoo-oam.conf missing - exiting"

cd $OAM_LOGDIR || oam_die "/var/log/oam is missing - exiting"

LOGDATE=$(ls -1dt 2* | head -1)

if [[ -z "$LOGDATE" ]] ; then
    LOGDATE=$(date +%Y%m%d)
    mkdir -p $LOGDATE
fi

TOPLOGFILES="error glsa oam"

for f in $TOPLOGFILES ; do
    [[ ! -f ${f}.log ]] && touch ${f}.log
done

multitail -x $HOSTNAME/oam/$LOGDATE \
	  -T --basename \
	  -ts --mergeall -iw $LOGDATE/\*.log 2 \
	  --no-mergeall \
	  -wh 4 error.log \
	  -wh 4 -ci red glsa.log \
	  -wh 4 oam.log \
	  -wh 6 -r 60 -l 'genlop --nocolor --current' \
	  -wh 1 -r 30 -l uptime

exit 0
