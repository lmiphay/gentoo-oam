#!/usr/bin/python

import sys
import os
import logging
import oam

def usage():
    return "usage: " + os.path.basename(sys.argv[0]) + " [-h] [-d] [<cmd>]"

if len(sys.argv) == 2 and sys.argv[1] == '-h':
    sys.exit(usage())
else:

    if len(sys.argv) >= 2 and sys.argv[1] == '-d':
        sys.argv.pop(1)
        loglevel = logging.DEBUG
    else:
        loglevel = logging.INFO

    logging.basicConfig(level=loglevel, format='%(asctime)s %(levelname)s %(message)s')
    logger = logging.getLogger("oam.main")
    logger.log(logging.DEBUG, 'main: sys.path=%s', str(sys.path))
    logger.log(logging.DEBUG, 'main: sys.argv=%s', str(sys.argv))

    if len(sys.argv) >= 2 and sys.argv[1] == 'expire':
        sys.argv.pop(1)
        app = oam.OAMExpire.create(sys.argv)
        sys.exit(app.run())
    elif len(sys.argv) >= 2 and sys.argv[1] == 'version':
        print(oam.version.__version__)
        sys.exit(0)
    else:
        sys.exit(usage())
